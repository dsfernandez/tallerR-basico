---
title: "Controles del Flujo"
output:
  html_document:
    css: !expr here::here("styles/styles.css")
    toc: true
    toc_depth:  3
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options("yaml.eval.expr" = TRUE)
```

# 2.3. Controles del Flujo  
Las __expresiones de control__ (_control statements_) son expresiones que se utilizan para controlar la ejecución y el flujo del programa según las condiciones proporcionadas en las expresiones. Estas estructuras se utilizan para tomar una decisión después de evaluar la variable.

## 2.3.1  Las expresiones con __if...else__  
__Al finalizar esta sección podrás utilizar la expresión _if...else_ para determinar la ruta en la aplicación de un código__  

### La expresión __if__ 

La sintaxis de esta expresión es:  

> __if__(prueba o condición) {  
expresión de control o acción  
}

![](media/r-if-statement.jpg)  
A continuación, un ejemplo del uso de __if__:  
```{r if}
# dato a probar
nx <- 7
# probar si el número es positivo
if(nx > 0){
print("Número Positivo")
}
```
__nx__ puede ser el resultado de un cálculo anterior y con el __if__ se le hace una prueba.

### La expresión __if...else__  

En este caso la sintaxis de esta expresión es:

> __if__(prueba o condición){  
expresión de control o acción si se cumple la condición  
} __else__ {    
expresión de control o acción si no se cumple la condición     
}  

![](media/r-if-else-statement.jpg)

Ejemplo del uso de __if...else__:  
```{r ifelse}
# dato a probar
nx <- -7
# probar si el número es positivo o negativo
if(nx > 0){
print("Número Positivo")
} else {
  print("Número Negativo")
}
```

### Uso combinado de __if...else__ con una función  

El resultado de aplicar una función puede condicionarse a la evaluación de los valores de entrada, según una serie de expresiones condicionales.  En este ejemplo vamos a aplicar una función a los valores de presión sanguínea (sistólica y diastólica), para evaluar la categoría de diagnóstico que le corresponde, de acuerdo a la tabla de la [American Heart Association](https://www.heart.org/-/media/health-topics-images/hbp/blood-pressure-readings-chart-english.jpg?la=en).  
```{r presion}
# creación de función
PSx <- function(s,d) {
  if (s <= 90 && d <= 60) {
    "Hipotensión"
  } else if (s < 120 && d <= 80) {
      "Presión Normal"
  } else if (s >= 120 && s <= 129 && d <= 80) {
      "Presión Elevada"
  } else if ((s >= 130 && s <= 139) || (d > 80 && d <= 89)) {
      "Hipertensión Etapa 1"
  } else if (s >= 140 || d >= 90) {
      "Hipertensión Etapa 2"
  } else if (s >= 180 || d >= 120) {
      "Crisis Hipertensiva"
    }
}
```

Una vez creada la función (PSx), podemos aplicarla a valores medidos de presión sistólica y diastólica.
```{r diagnostico}
# función PSx(sistólica, diastólica)
# paciente 1
PSx(117, 79)
# paciente 2
PSx(128,83)
```

## 2.3.2. Controles tipo bucle con __for__.
__Al finalizar esta sección podrás aplicar un código a una secuencia de valores o expresiones condicionales__  

Los bucles se utilizan en la programación para repetir un bloque de código específico.  Existen dos formas principales: __for__ y __while__.  

### La sintaxis para un bucle __for__  

> __for__ (valor indicador __in__ secuencia de valores)  
{  
expresión  
}

![](media/r-for-loop.jpg)  

A continuación un ejemplo del uso básico de __for__, para contar los números pares en una secuencia:
```{r for}
# secuencia x de valores
x <- c(2,5,3,9,8,11,6)
# inicio de variable acumuladora
count <- 0
# expresión for 
for (val in x) {
if(val %% 2 == 0)  count = count+1
}
print(count)
```

### Uso del bucle __while__  

Los bucles __while__ se utilizan para realizar un bucle hasta que se cumple una condición específica.  

Su sintaxis:  

> __while__ (expresión de control)  
{  
expresión  
}    

![](media/r-while-loop.jpg)  

Ejemplo de uso del bucle __while__:  
```{r while}
# variable con un valor inicial
i <- 1
# bucle while con un contador e instrucción de salida
while (i < 6) {
print(i)
i = i+1
}
```

### Uso combinado de __for__, __if__ y __else__  
Podemos combinar los diferentes tipos de control de flujo, según la tarea que deseamos realizar con los datos.  Usualmente hay varias formas de conseguir un mismo propósito, unas más eficientes que otras.  A continuación vamos analizar datos adquiridos en encuestas y mediciones relacionadas a los protocolos de prevención de CoviD-19; el propósito es "leer" los datos tomados al final del día y tomar una decisión de cómo actuar con los individuos para el otro día, de acuerdo a un protocolo de seguridad, traducido a expresiones de decisión dentro de un bucle __for__.  
```{r protocolo}
## creación de base de datos inicial
# temperatura máxima registrada en los individuos en un día
Temp <- c(38.5,38.2,36.8,38.4,37.1,38,36.8,37.5)
# Indicador de contacto con positivo confirmado
# 0 = no-contacto, 1 = contacto confirmado
Contacto <- c(0,1,0,1,1,0,0,0)
# variable de acción a tomar con individuo - condición inicial "NA"
Accion <- rep("NA",8)
# número secuencial de identificación
n <- length(Temp)
ID <- seq(1:n)
# data.frame
Entrada <- data.frame(ID,Temp,Contacto,Accion)
Entrada
```

Procesamos los datos según unas reglas de decisión pre-establecidas, y producimos un nuevo _data.frame_ (Entrada) con las acciones a tomar con los individuos.  
```{r decision}
# bucle con decisiones anidadas
for (i in ID)
  {
  if (Entrada$Temp[i] < 38 && Entrada$Contacto[i] == 0) {
    Entrada[i,4] <- c("Acceso")
  } else if (Entrada$Temp[i] >= 38 && Entrada$Contacto[i] != 0) {
    Entrada[i,4] <- c("NO-Acceso")
  } else if (Entrada$Temp[i] >= 38 || Entrada$Contacto[i] != 0) {
    Entrada[i,4] <- c("Vigilancia")
  }
}
# mostrar datos
Entrada
```


\

[  __Home__](https://dsfernandez.github.io/tallerR-basico/index.html)   

*** 